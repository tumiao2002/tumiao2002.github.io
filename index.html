<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>兔喵博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="程序媛的日常学习记录">
<meta property="og:type" content="website">
<meta property="og:title" content="兔喵博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="兔喵博客">
<meta property="og:description" content="程序媛的日常学习记录">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="tumiao">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="兔喵博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
      
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
<meta name="generator" content="Hexo 6.2.0"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate"></a></h1>
        </hgroup>

        
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/Home">博客首页</a></li>
                        
                            <li><a href="/works">作品展示</a></li>
                        
                            <li><a href="/about">留言打卡</a></li>
                        
                            <li><a href="/FrontEndGuide">前端导航</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=PAkNDgsKBQ4MCnxNTRJfU1E" title="mail">mail</a>
                            
                                <a class="fl github" target="_blank" href="https://github.com/luuman" title="github">github</a>
                            
                                <a class="fl zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
                            
                                <a class="fl weibo" target="_blank" href="#" title="weibo">weibo</a>
                            
                                <a class="fl google" target="_blank" href="#" title="google">google</a>
                            
                                <a class="fl twitter" target="_blank" href="#" title="twitter">twitter</a>
                            
                                <a class="fl linkedin" target="_blank" href="#" title="linkedin">linkedin</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://luuman.github.io/">name</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">纯海迷、爱运动、爱交友、爱旅行、喜欢接触新鲜事物、迎接新的挑战，更爱游离于错综复杂的编码与逻辑中</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/Home">博客首页</a></li>
                
                    <li><a href="/works">作品展示</a></li>
                
                    <li><a href="/about">留言打卡</a></li>
                
                    <li><a href="/FrontEndGuide">前端导航</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=PAkNDgsKBQ4MCnxNTRJfU1E" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://github.com/luuman" title="github">github</a>
                    
                        <a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
                    
                        <a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
                    
                        <a class="google" target="_blank" href="#" title="google">google</a>
                    
                        <a class="twitter" target="_blank" href="#" title="twitter">twitter</a>
                    
                        <a class="linkedin" target="_blank" href="#" title="linkedin">linkedin</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-test" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/07/10/test/" class="article-date">
      <time datetime="2022-07-10T12:10:43.535Z" itemprop="datePublished">2022-07-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="skgsdjkg"><a href="#skgsdjkg" class="headerlink" title="skgsdjkg"></a>skgsdjkg</h1><p><img src="/../images/image-20220710201152388.png" alt="image-20220710201152388"></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-springcloud学习/Docker" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/07/10/springcloud%E5%AD%A6%E4%B9%A0/Docker/" class="article-date">
      <time datetime="2022-07-10T09:15:47.058Z" itemprop="datePublished">2022-07-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="1-认识Docker"><a href="#1-认识Docker" class="headerlink" title="1.认识Docker"></a>1.认识Docker</h2><p><img src="/../../images/image-20220710191545602.png" alt="image-20220710191545602"></p>
<p><img src="/../../images/image-20220710191641845.png" alt="image-20220710191641845"></p>
<h3 id="1-1Docker和虚拟机的差异："><a href="#1-1Docker和虚拟机的差异：" class="headerlink" title="1.1Docker和虚拟机的差异："></a>1.1Docker和虚拟机的差异：</h3><p><img src="/../../images/image-20220710193031452.png" alt="image-20220710193031452"></p>
<p><strong>Docker是在操作系统上直接运行的</strong></p>
<h3 id="1-2Docker架构"><a href="#1-2Docker架构" class="headerlink" title="1.2Docker架构"></a>1.2Docker架构</h3><p><img src="/../../images/image-20220710193651225.png" alt="image-20220710193651225"></p>
<p><img src="/../../images/image-20220710210846933.png" alt="image-20220710210846933"></p>
<p><img src="/../../images/image-20220710211052852.png" alt="image-20220710211052852"></p>
<p><img src="/../../images/image-20220710211156519.png" alt="image-20220710211156519"></p>
<h3 id="1-3Docker安装（在centos7上安装docker）"><a href="#1-3Docker安装（在centos7上安装docker）" class="headerlink" title="1.3Docker安装（在centos7上安装docker）"></a>1.3Docker安装（在centos7上安装docker）</h3><h2 id="2-使用Docker"><a href="#2-使用Docker" class="headerlink" title="2.使用Docker"></a>2.使用Docker</h2>
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-springcloud学习/统一网关Gateway" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/07/10/springcloud%E5%AD%A6%E4%B9%A0/%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3Gateway/" class="article-date">
      <time datetime="2022-07-10T03:52:11.742Z" itemprop="datePublished">2022-07-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="GateWay"><a href="#GateWay" class="headerlink" title="GateWay"></a>GateWay</h1><h2 id="学习过程供踩过的坑："><a href="#学习过程供踩过的坑：" class="headerlink" title="学习过程供踩过的坑："></a>学习过程供踩过的坑：</h2><h3 id="1-出错reactor-core-Exceptions-ErrorCallbackNotImplemented-java-lang-IllegalArgumentException-The-parameter-lb-x2F-x2F-orderservice-format-is-incorrect-scheme-can-not-be-empty"><a href="#1-出错reactor-core-Exceptions-ErrorCallbackNotImplemented-java-lang-IllegalArgumentException-The-parameter-lb-x2F-x2F-orderservice-format-is-incorrect-scheme-can-not-be-empty" class="headerlink" title="1.出错reactor.core.Exceptions$ErrorCallbackNotImplemented: java.lang.IllegalArgumentException: The parameter [lb&#x2F;&#x2F;orderservice] format is incorrect, scheme can not be empty"></a>1.出错reactor.core.Exceptions$ErrorCallbackNotImplemented: java.lang.IllegalArgumentException: The parameter [lb&#x2F;&#x2F;orderservice] format is incorrect, scheme can not be empty</h3><p><img src="/../../images/image-20220710143746835.png" alt="image-20220710143746835"></p>
<p><strong>lb后面忘了加冒号“:”了哈哈哈哈哈哈</strong></p>
<h2 id="1-网关作用："><a href="#1-网关作用：" class="headerlink" title="1.网关作用："></a>1.网关作用：</h2><p><img src="/../../images/image-20220710115928562.png" alt="image-20220710115928562"></p>
<p><img src="/../../images/image-20220710121903581.png" alt="image-20220710121903581"></p>
<h2 id="2-搭建网关服务"><a href="#2-搭建网关服务" class="headerlink" title="2.搭建网关服务"></a>2.搭建网关服务</h2><h3 id="1-创建项目，引入nacos服务发现和gateWay依赖："><a href="#1-创建项目，引入nacos服务发现和gateWay依赖：" class="headerlink" title="1.创建项目，引入nacos服务发现和gateWay依赖："></a>1.创建项目，引入nacos服务发现和gateWay依赖：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--        引入nacos服务发现依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">&lt;!--        网关依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-配置application-yml，包括服务基本信息，nacos地址，路由，例如："><a href="#2-配置application-yml，包括服务基本信息，nacos地址，路由，例如：" class="headerlink" title="2.配置application.yml，包括服务基本信息，nacos地址，路由，例如："></a>2.配置application.yml，包括服务基本信息，nacos地址，路由，例如：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 10010</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: gateway</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      server-addr: localhost:8848 # nacos地址</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">        - id: user-sevice #路由标示，必须唯一，也可以理解为id</span><br><span class="line">          uri: lb://userservice #路由的目标地址</span><br><span class="line">          predicates: #路由断言，判断请求是否符合规则</span><br><span class="line">            - Path=/user/** #路径断言，判断路径是否是以/user开头，如果是，则符合</span><br><span class="line">        - id: order-service</span><br><span class="line">          uri: lb://orderservice</span><br><span class="line">          predicates:</span><br><span class="line">            - Path=/order/**</span><br></pre></td></tr></table></figure>

<h3 id="整个服务过程示例："><a href="#整个服务过程示例：" class="headerlink" title="整个服务过程示例："></a>整个服务过程示例：</h3><p><img src="/../../images/image-20220710144259240.png" alt="image-20220710144259240"></p>
<p><img src="/../../images/image-20220710144423475.png" alt="image-20220710144423475"></p>
<h2 id="3-路由断言工厂"><a href="#3-路由断言工厂" class="headerlink" title="3.路由断言工厂"></a>3.路由断言工厂</h2><p><img src="/../../images/image-20220710144527335.png" alt="image-20220710144527335"></p>
<p><img src="/../../images/image-20220710145452325.png" alt="image-20220710145452325"></p>
<h2 id="4-路由的过滤器配置-GatewayFilter"><a href="#4-路由的过滤器配置-GatewayFilter" class="headerlink" title="4.路由的过滤器配置 GatewayFilter"></a>4.路由的过滤器配置 GatewayFilter</h2><p><strong>Gatewayilter是网关提供的一种过滤器，可以对 路由的请求或响应做加工处理，比如添加请求头</strong></p>
<p><img src="/../../images/image-20220710145806613.png" alt="image-20220710145806613"></p>
<p><strong>default-filters:对所有路由都生效，与routes同级</strong></p>
<h3 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h3><p><strong>给userservice服务添加请求头：</strong></p>
<p><img src="/../../images/image-20220710150657322.png" alt="image-20220710150657322"></p>
<p><strong>所有服务都生效：注意default-filters与routes同一级</strong></p>
<p><img src="/../../images/image-20220710151009441.png" alt="image-20220710151009441"></p>
<h2 id="5-全局过滤器-GlobalFilter"><a href="#5-全局过滤器-GlobalFilter" class="headerlink" title="5.全局过滤器 GlobalFilter"></a>5.全局过滤器 GlobalFilter</h2><p><strong>作用与GatewayFilter的作用一样，区别在于Global的逻辑需要在自己写代码实现，而不是靠spring来实现的</strong></p>
<h3 id="1-实现GlobalFiler接口"><a href="#1-实现GlobalFiler接口" class="headerlink" title="1.实现GlobalFiler接口"></a>1.实现GlobalFiler接口</h3><h3 id="2-添加-Order注解或实现ordered接口"><a href="#2-添加-Order注解或实现ordered接口" class="headerlink" title="2.添加@Order注解或实现ordered接口"></a>2.添加@Order注解或实现ordered接口</h3><h3 id="3-编写处理逻辑"><a href="#3-编写处理逻辑" class="headerlink" title="3.编写处理逻辑"></a>3.编写处理逻辑</h3><h3 id="示例：定义全局过滤器，拦截并判断用户身份"><a href="#示例：定义全局过滤器，拦截并判断用户身份" class="headerlink" title="示例：定义全局过滤器，拦截并判断用户身份"></a>示例：定义全局过滤器，拦截并判断用户身份</h3><p><img src="/../../images/image-20220710163413075.png" alt="image-20220710163413075"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@Order(-1)//里面的值决定优先级，越小优先级越高</span><br><span class="line">@Component</span><br><span class="line">public class AuthorrizeFilter implements GlobalFilter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;</span><br><span class="line">         //1.获取请求参数</span><br><span class="line">        ServerHttpRequest request = exchange.getRequest();</span><br><span class="line">        MultiValueMap&lt;String, String&gt; queryParams = request.getQueryParams();</span><br><span class="line">        //2.获取参数中的authorization参数</span><br><span class="line">        String authorization = queryParams.getFirst(&quot;authorization&quot;);</span><br><span class="line">        //3.判断参数值是否等于admin</span><br><span class="line">        if (&quot;admin&quot;.equals(authorization))</span><br><span class="line">        &#123;</span><br><span class="line">            //4.是，放行</span><br><span class="line">            return chain.filter(exchange);</span><br><span class="line">        &#125;</span><br><span class="line">        //5.否，拦截</span><br><span class="line">        //5.1设置状态码</span><br><span class="line">        exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        //5.2拦截请求</span><br><span class="line">        return exchange.getResponse().setComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-过滤器的执行顺序"><a href="#4-过滤器的执行顺序" class="headerlink" title="4.过滤器的执行顺序"></a>4.过滤器的执行顺序</h2><p><img src="/../../images/image-20220710170622340.png" alt="image-20220710170622340"></p>
<p><img src="/../../images/image-20220710170902589.png" alt="image-20220710170902589"></p>
<p><img src="/../../images/image-20220710170923311.png" alt="image-20220710170923311"></p>
<h2 id="5-网关的跨域问题处理"><a href="#5-网关的跨域问题处理" class="headerlink" title="5.网关的跨域问题处理"></a>5.网关的跨域问题处理</h2><p><img src="/../../images/image-20220710171309208.png" alt="image-20220710171309208"></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-maven遇到的问题" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/07/08/maven%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/" class="article-date">
      <time datetime="2022-07-08T04:31:10.987Z" itemprop="datePublished">2022-07-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="在配置maven系统变量时，全局mvn命令突然不生效了，但是按照路径来又可以正常运行"><a href="#在配置maven系统变量时，全局mvn命令突然不生效了，但是按照路径来又可以正常运行" class="headerlink" title="在配置maven系统变量时，全局mvn命令突然不生效了，但是按照路径来又可以正常运行"></a>在配置maven系统变量时，全局mvn命令突然不生效了，但是按照路径来又可以正常运行</h1><p>解决方法，在系统的path变量中，直接引入maven bin 路径，如下：</p>
<p><img src="/../images/image-20220708123331712.png" alt="image-20220708123331712"></p>
<h2 id="maven-项目出现：Caused-by-java-lang-NoSuchMethodError-org-apache-maven-model-validation-DefaultModelValidator-method-‘void-’-not-found"><a href="#maven-项目出现：Caused-by-java-lang-NoSuchMethodError-org-apache-maven-model-validation-DefaultModelValidator-method-‘void-’-not-found" class="headerlink" title="maven 项目出现：Caused by: java.lang.NoSuchMethodError: org.apache.maven.model.validation.DefaultModelValidator: method ‘void ()’ not found"></a>maven 项目出现：Caused by: java.lang.NoSuchMethodError: org.apache.maven.model.validation.DefaultModelValidator: method ‘void <init>()’ not found</h2><p>冲突问题，需要重新构建项目</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-idea配置maven环境" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/07/07/idea%E9%85%8D%E7%BD%AEmaven%E7%8E%AF%E5%A2%83/" class="article-date">
      <time datetime="2022-07-07T14:06:36.556Z" itemprop="datePublished">2022-07-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="idea配置maven环境"><a href="#idea配置maven环境" class="headerlink" title="idea配置maven环境"></a>idea配置maven环境</h1><p>[TOC]</p>
<h2 id="1-下载maven安装包并解压："><a href="#1-下载maven安装包并解压：" class="headerlink" title="1.下载maven安装包并解压："></a>1.下载maven安装包并解压：</h2><p>&#x3D;&#x3D;下载官网：<a target="_blank" rel="noopener" href="https://maven.apache.org/download.cgi">Maven – Download Apache Maven</a>&#x3D;&#x3D;</p>
<p><img src="/../images/image-20220708114249854.png" alt="image-20220708114249854"></p>
<p><img src="/../images/image-20220708114317922.png" alt="image-20220708114317922"></p>
<h2 id="2-配置环境变量"><a href="#2-配置环境变量" class="headerlink" title="2.配置环境变量"></a>2.配置环境变量</h2><p><img src="/../images/image-20220708114424202.png" alt="image-20220708114424202"></p>
<h2 id="3-命令行输入mvn-version-出现版本信息代表配置成功"><a href="#3-命令行输入mvn-version-出现版本信息代表配置成功" class="headerlink" title="3.命令行输入mvn -version ,出现版本信息代表配置成功"></a>3.命令行输入mvn -version ,出现版本信息代表配置成功</h2><p><img src="/../images/image-20220708114533786.png" alt="image-20220708114533786"></p>
<h2 id="4-maven配置阿里源"><a href="#4-maven配置阿里源" class="headerlink" title="4.maven配置阿里源"></a>4.maven配置阿里源</h2><h3 id="4-1-创建maven自定义本地仓库"><a href="#4-1-创建maven自定义本地仓库" class="headerlink" title="4.1 创建maven自定义本地仓库"></a>4.1 创建maven自定义本地仓库</h3><p><img src="/../images/image-20220708114713084.png" alt="image-20220708114713084"></p>
<h3 id="4-2-打开maven钟conf目录下的settings-xml文件，开始进行编辑"><a href="#4-2-打开maven钟conf目录下的settings-xml文件，开始进行编辑" class="headerlink" title="4.2 打开maven钟conf目录下的settings.xml文件，开始进行编辑"></a>4.2 打开maven钟conf目录下的settings.xml文件，开始进行编辑</h3><p> 4.2.1 把本地仓库路径添加到如下位置：</p>
<p><img src="/../images/image-20220708114949429.png" alt="image-20220708114949429"></p>
<p>4.2.2 在<mirros></mirros>内部注释掉原来代码，添加以下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置阿里云--&gt;</span><br><span class="line">    &lt;mirror&gt;      </span><br><span class="line">       &lt;id&gt;nexus-aliyun&lt;/id&gt;    </span><br><span class="line">       &lt;name&gt;nexus-aliyun&lt;/name&gt;  </span><br><span class="line">       &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;    </span><br><span class="line">         &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;      </span><br><span class="line">    &lt;/mirror&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">        &lt;id&gt;alimaven&lt;/id&gt;</span><br><span class="line">        &lt;name&gt;aliyun maven&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;</span><br><span class="line">        &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">    &lt;/mirror&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">        &lt;id&gt;alimaven-central&lt;/id&gt;</span><br><span class="line">        &lt;name&gt;aliyun maven central&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;https://maven.aliyun.com/repository/central&lt;/url&gt;</span><br><span class="line">        &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">    &lt;/mirror&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">        &lt;id&gt;alimaven-spring&lt;/id&gt;</span><br><span class="line">        &lt;name&gt;aliyun maven-spring&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;https://maven.aliyun.com/repository/spring&lt;/url&gt;</span><br><span class="line">        &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">    &lt;/mirror&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">        &lt;id&gt;central&lt;/id&gt;</span><br><span class="line">        &lt;name&gt;Maven Repository Switchboard&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;https://repo1.maven.org/maven2/&lt;/url&gt;</span><br><span class="line">        &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">    &lt;/mirror&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">        &lt;id&gt;jboss-public-repository-group&lt;/id&gt;</span><br><span class="line">        &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">        &lt;name&gt;JBoss Public Repository Group&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;http://repository.jboss.org/nexus/content/groups/public&lt;/url&gt;</span><br><span class="line">    &lt;/mirror&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">        &lt;id&gt;spring-snapshots&lt;/id&gt;</span><br><span class="line">        &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">        &lt;name&gt;Spring Snapshots&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;</span><br><span class="line">    &lt;/mirror&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">        &lt;id&gt;spring-milestones&lt;/id&gt;</span><br><span class="line">        &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</span><br><span class="line">        &lt;name&gt;Spring Milestones&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;https://repo.spring.io/milestone&lt;/url&gt;</span><br><span class="line">    &lt;/mirror&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">      &lt;id&gt;maven-default-http-blocker&lt;/id&gt;</span><br><span class="line">      &lt;mirrorOf&gt;external:http:*&lt;/mirrorOf&gt;</span><br><span class="line">      &lt;name&gt;Pseudo repository to mirror external repositories initially using HTTP.&lt;/name&gt;</span><br><span class="line">      &lt;url&gt;http://0.0.0.0/&lt;/url&gt;</span><br><span class="line">      &lt;blocked&gt;true&lt;/blocked&gt;</span><br><span class="line">    &lt;/mirror&gt;</span><br></pre></td></tr></table></figure>

<p>4.2.3 命令行输入 mvn help:system ，显示如下代表配置成功：</p>
<p><img src="/../images/image-20220708115907501.png" alt="image-20220708115907501"></p>
<h2 id="5-idea配置本地maven"><a href="#5-idea配置本地maven" class="headerlink" title="5.idea配置本地maven"></a>5.idea配置本地maven</h2><h3 id="2-1"><a href="#2-1" class="headerlink" title="2.1"></a>2.1</h3><p><img src="/../images/image-20220707220954910.png" alt="image-20220707220954910"></p>
<h3 id="2-2-maven-home选择到下载解压的maven文件，settings选择下载的maven中的settings-repository选择下载的repository文件夹"><a href="#2-2-maven-home选择到下载解压的maven文件，settings选择下载的maven中的settings-repository选择下载的repository文件夹" class="headerlink" title="2.2 maven home选择到下载解压的maven文件，settings选择下载的maven中的settings,repository选择下载的repository文件夹"></a>2.2 maven home选择到下载解压的maven文件，settings选择下载的maven中的settings,repository选择下载的repository文件夹</h3><ol>
<li></li>
</ol>
<p><img src="/../images/image-20220708120118906.png" alt="image-20220708120118906"></p>
<ol start="2">
<li></li>
</ol>
<p>mavan home:</p>
<p><img src="/../images/image-20220707221212437.png" alt="image-20220707221212437"></p>
<p>settings:</p>
<p><img src="/../images/image-20220707221226331.png" alt="image-20220707221226331"></p>
<p>repository:</p>
<p><img src="/../images/image-20220707221241484.png" alt="image-20220707221241484"></p>
<h3 id="2-3-点击确定，就完成啦"><a href="#2-3-点击确定，就完成啦" class="headerlink" title="2.3 点击确定，就完成啦"></a>2.3 点击确定，就完成啦</h3>
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-springcloud学习/Feign" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/07/07/springcloud%E5%AD%A6%E4%B9%A0/Feign/" class="article-date">
      <time datetime="2022-07-07T13:32:51.886Z" itemprop="datePublished">2022-07-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>[TOC]</p>
<h1 id="一些踩坑："><a href="#一些踩坑：" class="headerlink" title="一些踩坑："></a>一些踩坑：</h1><h2 id="1-maven导入feign客户端依赖失败"><a href="#1-maven导入feign客户端依赖失败" class="headerlink" title="1.maven导入feign客户端依赖失败"></a>1.maven导入feign客户端依赖失败</h2><p><img src="/../../images/image-20220707222258430.png" alt="image-20220707222258430"></p>
<h2 id="2-com-netflix-client-ClientException-Load-balancer-does-not-have-available-server-for-client-userservice"><a href="#2-com-netflix-client-ClientException-Load-balancer-does-not-have-available-server-for-client-userservice" class="headerlink" title="2.com.netflix.client.ClientException: Load balancer does not have available server for client: userservice"></a>2.com.netflix.client.ClientException: Load balancer does not have available server for client: userservice</h2><h3 id="2-1检查nacos是否成功注册，检测到userservice和orderservice都未成功注册"><a href="#2-1检查nacos是否成功注册，检测到userservice和orderservice都未成功注册" class="headerlink" title="2.1检查nacos是否成功注册，检测到userservice和orderservice都未成功注册"></a>2.1检查nacos是否成功注册，检测到userservice和orderservice都未成功注册</h3><h3 id="userservice未成功注册的原因，加了yaml的nacos配置文件，忘了加对应的配置管理依赖："><a href="#userservice未成功注册的原因，加了yaml的nacos配置文件，忘了加对应的配置管理依赖：" class="headerlink" title="userservice未成功注册的原因，加了yaml的nacos配置文件，忘了加对应的配置管理依赖："></a>userservice未成功注册的原因，加了yaml的nacos配置文件，忘了加对应的配置管理依赖：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--        nacos的配置管理依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="/../../images/image-20220708223621786.png" alt="image-20220708223621786"></p>
<p>但错误还是存在，看是否是因为orderservice未成功注册</p>
<h3 id="orderservice未成功注册的原因："><a href="#orderservice未成功注册的原因：" class="headerlink" title="orderservice未成功注册的原因："></a>orderservice未成功注册的原因：</h3><p>。。。。。。注册成功了，但是我把它弄到dev的环境了，一时没有看见。。。。。，如下：</p>
<p><img src="/../../images/image-20220708230750512.png" alt="image-20220708230750512"></p>
<p>​         <strong>所以出现这个错误的原因是，两个服务被放到不同环境啦，直接隔离了，所以调取不到，弄到一个环境就可以啦</strong></p>
<p>​	<strong>就是这行代码，将orderservice直接隔离在的de环境，namespace后面的是相应环境的id</strong></p>
<p><img src="/../../images/image-20220708232234700.png" alt="image-20220708232234700"></p>
<p>​	<strong>我这里是直接注释掉了环境配置代码，然后重新启动让orderservice与userservice一样进入默认环境，如下：</strong></p>
<p>​     <img src="/../../images/image-20220708232834185.png" alt="image-20220708232834185"></p>
<p>​                      <strong>再进行Feign远程调用，成功没报错啦！也调用出数据了：</strong></p>
<p><img src="/../../images/image-20220708233100711.png" alt="image-20220708233100711"></p>
<p>**但是这里又出现了新问题，调出为null **</p>
<p><img src="/../../images/image-20220708233528984.png" alt="image-20220708233528984"></p>
<p><strong>结果是代码写错啦，orderId这里应该写返回的order.getUserId,修改一下后重新启动</strong></p>
<p><strong>成功啦！</strong></p>
<p><img src="/../../images/image-20220708233848388.png" alt="image-20220708233848388"></p>
<h3 id="2-2-orderservice调用userservice的话，userservice要userservice服务先运行，再运行orderservice-不然会出现一样的报错"><a href="#2-2-orderservice调用userservice的话，userservice要userservice服务先运行，再运行orderservice-不然会出现一样的报错" class="headerlink" title="2.2 orderservice调用userservice的话，userservice要userservice服务先运行，再运行orderservice,不然会出现一样的报错"></a>2.2 orderservice调用userservice的话，userservice要userservice服务先运行，再运行orderservice,不然会出现一样的报错</h3><h1 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h1><p>一个声明式的http客户端，帮助我们简洁地实现http的发送</p>
<p>例如：</p>
<p><img src="/../../images/image-20220707213919228.png" alt="image-20220707213919228"></p>
<h2 id="1-基于Ferign远程调用"><a href="#1-基于Ferign远程调用" class="headerlink" title="1.基于Ferign远程调用"></a>1.基于Ferign远程调用</h2><h3 id="1-1需要使用Fegin进行调用的微程序，pom引入依赖："><a href="#1-1需要使用Fegin进行调用的微程序，pom引入依赖：" class="headerlink" title="1.1需要使用Fegin进行调用的微程序，pom引入依赖："></a>1.1需要使用Fegin进行调用的微程序，pom引入依赖：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--        导入feign客户端依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="1-2在Application添加-EnableFeignClients-注解-x2F-x2F-自动装配的开关：开启自动装配"><a href="#1-2在Application添加-EnableFeignClients-注解-x2F-x2F-自动装配的开关：开启自动装配" class="headerlink" title="1.2在Application添加@EnableFeignClients 注解&#x2F;&#x2F;自动装配的开关：开启自动装配"></a>1.2在Application添加@EnableFeignClients 注解&#x2F;&#x2F;自动装配的开关：开启自动装配</h3><p><img src="/../../images/image-20220708234229094.png" alt="image-20220708234229094"></p>
<h3 id="1-3编写FeignClient接口，如下："><a href="#1-3编写FeignClient接口，如下：" class="headerlink" title="1.3编写FeignClient接口，如下："></a>1.3编写FeignClient接口，如下：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 整个接口的声明</span><br><span class="line"> */</span><br><span class="line">@FeignClient(&quot;userservice&quot;)//”userservice“:声明的服务名称</span><br><span class="line">public interface UserClient &#123;</span><br><span class="line">    @GetMapping(&quot;/user/&#123;id&#125;&quot;)</span><br><span class="line">    User findById(@PathVariable(&quot;id&quot;) Long id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4使用FeignClient编写的方法代替RestTemplate（没有这个方法的可直接忽略代替及其后的话），如下："><a href="#1-4使用FeignClient编写的方法代替RestTemplate（没有这个方法的可直接忽略代替及其后的话），如下：" class="headerlink" title="1.4使用FeignClient编写的方法代替RestTemplate（没有这个方法的可直接忽略代替及其后的话），如下："></a>1.4使用FeignClient编写的方法代替RestTemplate（没有这个方法的可直接忽略代替及其后的话），如下：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private UserClient userClient;</span><br><span class="line">public Order queryOrderById(Long orderId) &#123;</span><br><span class="line">    // 1.查询订单</span><br><span class="line">    Order order = orderMapper.findById(orderId);</span><br><span class="line">    // 2.用Feign远程调用</span><br><span class="line">    User user = userClient.findById(order.getUserId());</span><br><span class="line">    //3.封装User到Order</span><br><span class="line">    order.setUser(user);</span><br><span class="line">    // 4.返回</span><br><span class="line">    return order;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../../images/image-20220708234525220.png" alt="image-20220708234525220"></p>
<h2 id="2-Feign的配置"><a href="#2-Feign的配置" class="headerlink" title="2.Feign的配置"></a>2.Feign的配置</h2><p><img src="/../../images/image-20220710105908457.png" alt="image-20220710105908457"></p>
<p>&#x3D;&#x3D;<strong>（我们常用配置是日志级别，所以以下都是日志的举例实现）</strong>&#x3D;&#x3D;</p>
<h3 id="方式一：用配置文件来自定义Feign配置"><a href="#方式一：用配置文件来自定义Feign配置" class="headerlink" title="方式一：用配置文件来自定义Feign配置"></a>方式一：用配置文件来自定义Feign配置</h3><p>**代码如下： **</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">feign:</span><br><span class="line">  client:</span><br><span class="line">    config:</span><br><span class="line">      default: #如果是写的指定服务名称就是指定的服务运行，如果是default,就是所有服务都运行</span><br><span class="line">        loggerLevel: Full #指定展示什么信息，这里是Full,就是所有信息</span><br></pre></td></tr></table></figure>

<p><img src="/../../images/image-20220710111300632.png" alt="image-20220710111300632"></p>
<p><strong>结果如下：</strong></p>
<p><img src="/../../images/image-20220710111331366.png" alt="image-20220710111331366"></p>
<h3 id="方式二：用Java代码来实现Fegin自定义配置"><a href="#方式二：用Java代码来实现Fegin自定义配置" class="headerlink" title="方式二：用Java代码来实现Fegin自定义配置"></a>方式二：用Java代码来实现Fegin自定义配置</h3><h4 id="1-首先声明一个Bean"><a href="#1-首先声明一个Bean" class="headerlink" title="1.首先声明一个Bean:"></a>1.首先声明一个Bean:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class DefaultFeignConfiguration &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public Logger.Level logLevel()</span><br><span class="line">    &#123;</span><br><span class="line">        return Logger.Level.BASIC;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-如果是全局配置，则把它放到-EnableFeignClients这个注解中："><a href="#2-如果是全局配置，则把它放到-EnableFeignClients这个注解中：" class="headerlink" title="2.如果是全局配置，则把它放到@EnableFeignClients这个注解中："></a>2.如果是全局配置，则把它放到@EnableFeignClients这个注解中：</h4><p><img src="/../../images/image-20220710112359495.png" alt="image-20220710112359495"></p>
<h4 id="3-如果是局部配置，则把它放到-FeignClient这个注解中"><a href="#3-如果是局部配置，则把它放到-FeignClient这个注解中" class="headerlink" title="3.如果是局部配置，则把它放到@FeignClient这个注解中"></a>3.如果是局部配置，则把它放到@FeignClient这个注解中</h4><p><img src="/../../images/image-20220710112455737.png" alt="image-20220710112455737"></p>
<h2 id="3-Feign性能优化"><a href="#3-Feign性能优化" class="headerlink" title="3.Feign性能优化"></a>3.Feign性能优化</h2><p><img src="/../../images/image-20220710112611053.png" alt="image-20220710112611053"></p>
<p><img src="/../../images/image-20220710112710707.png" alt="image-20220710112710707"></p>
<h3 id="1-使用连接池代替默认URLConnection："><a href="#1-使用连接池代替默认URLConnection：" class="headerlink" title="1.使用连接池代替默认URLConnection："></a>1.使用连接池代替默认URLConnection：</h3><h4 id="1-1导入依赖："><a href="#1-1导入依赖：" class="headerlink" title="1.1导入依赖："></a>1.1导入依赖：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--引入HttpClient依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;feign-httpclient&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-修改配置文件"><a href="#1-2-修改配置文件" class="headerlink" title="1.2 修改配置文件:"></a>1.2 修改配置文件:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">feign:</span><br><span class="line">  httpclient:</span><br><span class="line">    enabled: true #支持HttpClient的开关</span><br><span class="line">    max-connections: 200 #最大连接数</span><br><span class="line">    max-connections-per-route: 50 #单个路径的最大连接数</span><br></pre></td></tr></table></figure>

<h3 id="2-修改日志级别：最好用basic或none-见-2"><a href="#2-修改日志级别：最好用basic或none-见-2" class="headerlink" title="2.修改日志级别：最好用basic或none(见##2)"></a>2.修改日志级别：最好用basic或none(见##2)</h3><h2 id="4-Feign的最佳实践"><a href="#4-Feign的最佳实践" class="headerlink" title="4.Feign的最佳实践"></a>4.Feign的最佳实践</h2><h3 id="方式一（继承）：给消费者的FeignClient和提供者的controller定义统一的父接口作为标准"><a href="#方式一（继承）：给消费者的FeignClient和提供者的controller定义统一的父接口作为标准" class="headerlink" title="方式一（继承）：给消费者的FeignClient和提供者的controller定义统一的父接口作为标准"></a>方式一（继承）：给消费者的FeignClient和提供者的controller定义统一的父接口作为标准</h3><p><img src="/../../images/image-20220710114641689.png" alt="image-20220710114641689"></p>
<h3 id="方式二（抽取）：将FeignClient抽取为独立模块，并且把接口有关的POJO、默认的Feign配置都放到这个模块中，提供给所有消费者使用"><a href="#方式二（抽取）：将FeignClient抽取为独立模块，并且把接口有关的POJO、默认的Feign配置都放到这个模块中，提供给所有消费者使用" class="headerlink" title="方式二（抽取）：将FeignClient抽取为独立模块，并且把接口有关的POJO、默认的Feign配置都放到这个模块中，提供给所有消费者使用"></a>方式二（抽取）：将FeignClient抽取为独立模块，并且把接口有关的POJO、默认的Feign配置都放到这个模块中，提供给所有消费者使用</h3><p><img src="/../../images/image-20220710115042600.png" alt="image-20220710115042600"></p>
<p><img src="/../../images/image-20220710115147598.png" alt="image-20220710115147598"></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-springcloud学习/Nacos配置管理" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/07/07/springcloud%E5%AD%A6%E4%B9%A0/Nacos%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/" class="article-date">
      <time datetime="2022-07-07T08:20:34.281Z" itemprop="datePublished">2022-07-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>[TOC]</p>
<h1 id="Nacos-配置管理"><a href="#Nacos-配置管理" class="headerlink" title="Nacos 配置管理"></a>Nacos 配置管理</h1><h2 id="统一配置管理"><a href="#统一配置管理" class="headerlink" title="统一配置管理"></a>统一配置管理</h2><h3 id="1-实现配置管理："><a href="#1-实现配置管理：" class="headerlink" title="1.实现配置管理："></a>1.实现配置管理：</h3><p>1.1<img src="/../../images/image-20220707173117987.png" alt="image-20220707173117987"></p>
<p>1.2 添加信息，示例如下：一般Data ID命名是：服务名称+-命名空间+.文件类型，配置内容中放入需要改变的配置，进行热更新</p>
<p><img src="/../../images/image-20220707173047386.png" alt="image-20220707173047386"></p>
<h3 id="2-微服务配置拉取："><a href="#2-微服务配置拉取：" class="headerlink" title="2.微服务配置拉取："></a>2.微服务配置拉取：</h3><h3 id="2-1配置获取步骤："><a href="#2-1配置获取步骤：" class="headerlink" title="2.1配置获取步骤："></a>2.1配置获取步骤：</h3><p><img src="/../../images/image-20220707173802030.png" alt="image-20220707173802030"></p>
<h3 id="2-2将配置交给nacos管理的步骤："><a href="#2-2将配置交给nacos管理的步骤：" class="headerlink" title="2.2将配置交给nacos管理的步骤："></a>2.2将配置交给nacos管理的步骤：</h3><p>2.2.1 在nacos中添加配置文件：</p>
<p><img src="/../../images/image-20220707180129556.png" alt="image-20220707180129556"></p>
<p>2.2.2 微服务中引入nacos的配置管理依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--        nacos的配置管理依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>2.2.3 在微服务中（resourse下）添加bootstrp.yaml,配置服务名称，服务环境，nacos地址，文件后缀名，并注释到application.yml文件中的冲突信息</p>
<p>bootstrap.yaml 告诉应用应该去哪儿拉取，要拉取谁</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: userservice #服务名称</span><br><span class="line">  profiles:</span><br><span class="line">    active: dev #环境</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      server-addr: localhost:8848 #nacos地址</span><br><span class="line">      config:</span><br><span class="line">        file-extension: yaml #文件后缀名</span><br></pre></td></tr></table></figure>

<h2 id="3-配置的热更新（配置的自动刷新）"><a href="#3-配置的热更新（配置的自动刷新）" class="headerlink" title="3.配置的热更新（配置的自动刷新）"></a>3.配置的热更新（配置的自动刷新）</h2><h3 id="方式1：通过-Value注解注入，结合-RefreshScope来刷新："><a href="#方式1：通过-Value注解注入，结合-RefreshScope来刷新：" class="headerlink" title="方式1：通过@Value注解注入，结合@RefreshScope来刷新："></a>方式1：通过@Value注解注入，结合@RefreshScope来刷新：</h3><p><img src="/../../images/image-20220707184605547.png" alt="image-20220707184605547"></p>
<p><img src="/../../images/image-20220707184619926.png" alt="image-20220707184619926"></p>
<h3 id="方式2：通过-ConfigurationProperties注入，自动刷新"><a href="#方式2：通过-ConfigurationProperties注入，自动刷新" class="headerlink" title="方式2：通过@ConfigurationProperties注入，自动刷新"></a>方式2：通过@ConfigurationProperties注入，自动刷新</h3><p><img src="/../../images/image-20220707184734317.png" alt="image-20220707184734317"></p>
<h3 id="注意：建议将一些关键参数，运行时需要调整的参数放到nacos配置中心，不然维护起来会比较麻烦"><a href="#注意：建议将一些关键参数，运行时需要调整的参数放到nacos配置中心，不然维护起来会比较麻烦" class="headerlink" title="注意：建议将一些关键参数，运行时需要调整的参数放到nacos配置中心，不然维护起来会比较麻烦"></a>注意：建议将一些关键参数，运行时需要调整的参数放到nacos配置中心，不然维护起来会比较麻烦</h3><h2 id="4-多环境配置共享"><a href="#4-多环境配置共享" class="headerlink" title="4. 多环境配置共享"></a>4. 多环境配置共享</h2><p>1.多种配置优先级：</p>
<p><img src="/../../images/image-20220707205639397.png" alt="image-20220707205639397"></p>
<p>2.微服务会从nacos读取的配置文件有：</p>
<p>服务名+环境的配置：环境配置</p>
<p><img src="/../../images/image-20220707205849491.png" alt="image-20220707205849491"></p>
<p>服务名不加环境的配置：多环境共享，.yaml无论什么情况下都会被读取，所以也称共享文件</p>
<p><img src="/../../images/image-20220707205918022.png" alt="image-20220707205918022"></p>
<h2 id="5-Nacos集群搭建"><a href="#5-Nacos集群搭建" class="headerlink" title="5.Nacos集群搭建"></a>5.Nacos集群搭建</h2><h3 id="1-集群结构图："><a href="#1-集群结构图：" class="headerlink" title="1.集群结构图："></a>1.集群结构图：</h3><p><img src="/../../images/image-20220707210450694.png" alt="image-20220707210450694"></p>
<h2 id="2-集群搭建：（待补充学习，暂时未细学）"><a href="#2-集群搭建：（待补充学习，暂时未细学）" class="headerlink" title="2.集群搭建：（待补充学习，暂时未细学）"></a>2.集群搭建：（待补充学习，暂时未细学）</h2><p><img src="/../../images/image-20220707213124333.png" alt="image-20220707213124333"></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-springcloud学习/Nacos于Eureka比较分析" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/07/07/springcloud%E5%AD%A6%E4%B9%A0/Nacos%E4%BA%8EEureka%E6%AF%94%E8%BE%83%E5%88%86%E6%9E%90/" class="article-date">
      <time datetime="2022-07-07T08:08:07.747Z" itemprop="datePublished">2022-07-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>[TOC]</p>
<h1 id="Nacos与eureka共同点"><a href="#Nacos与eureka共同点" class="headerlink" title="Nacos与eureka共同点"></a>Nacos与eureka共同点</h1><p>1.都支持服务注册和服务拉去</p>
<p>2.都支持服务提供心跳方式做健康检测</p>
<h1 id="Nacos与Eureka的区别"><a href="#Nacos与Eureka的区别" class="headerlink" title="Nacos与Eureka的区别"></a>Nacos与Eureka的区别</h1><p>1.Nacos临时实例心跳模式检测，非临时实例采用主动检测模式</p>
<p>2.临时实例心跳不征程会被剔除，非临时实例则不会被剔除</p>
<p>设置非临时实例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ephemeral: false #是否是临时实例</span><br></pre></td></tr></table></figure>

<p><img src="/../../images/image-20220707161855248.png" alt="image-20220707161855248"></p>
<p>3.Nacos支持服务列表变更的消息推送模式，服务列表更新更及时</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-springcloud学习/Nacos" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/07/04/springcloud%E5%AD%A6%E4%B9%A0/Nacos/" class="article-date">
      <time datetime="2022-07-04T14:13:20.020Z" itemprop="datePublished">2022-07-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>[TOC]</p>
<h1 id="Nacos学习过程中错误总结："><a href="#Nacos学习过程中错误总结：" class="headerlink" title="Nacos学习过程中错误总结："></a>Nacos学习过程中错误总结：</h1><h2 id="1-安装解压nacos后，启动错误"><a href="#1-安装解压nacos后，启动错误" class="headerlink" title="1.安装解压nacos后，启动错误"></a>1.安装解压nacos后，启动错误</h2><p>错误原因：直接运行startup.cmd</p>
<p>修改：打开cmd,切换到startup.cmd的目录，再执行开始代码（下面是启动单机模式的代码）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startup.cmd -m standalone</span><br></pre></td></tr></table></figure>

<h2 id="2-idea部署nacos后，启动出现错误：Caused-by-com-alibaba-nacos-api-exception-NacosException-failed-to-req-API-x2F-nacos-x2F-v1-x2F-ns-x2F-instance-after-all-servers-localhost-8848-tried-java-net-ConnectException-Connection-refused-connect"><a href="#2-idea部署nacos后，启动出现错误：Caused-by-com-alibaba-nacos-api-exception-NacosException-failed-to-req-API-x2F-nacos-x2F-v1-x2F-ns-x2F-instance-after-all-servers-localhost-8848-tried-java-net-ConnectException-Connection-refused-connect" class="headerlink" title="2.idea部署nacos后，启动出现错误：Caused by: com.alibaba.nacos.api.exception.NacosException: failed to req API:&#x2F;nacos&#x2F;v1&#x2F;ns&#x2F;instance after all servers([localhost:8848]) tried: java.net.ConnectException: Connection refused: connect"></a>2.idea部署nacos后，启动出现错误：Caused by: com.alibaba.nacos.api.exception.NacosException: failed to req API:&#x2F;nacos&#x2F;v1&#x2F;ns&#x2F;instance after all servers([localhost:8848]) tried: java.net.ConnectException: Connection refused: connect</h2><p>原来时nacos服务器没有启动，找到文件启动一下就好了</p>
<h1 id="Nacos注册"><a href="#Nacos注册" class="headerlink" title="Nacos注册"></a>Nacos注册</h1><h2 id="1-在父工程，也就是包含所有服务的大pom-xml中配置nacos服务端依赖：（注意不要忘记版本号）"><a href="#1-在父工程，也就是包含所有服务的大pom-xml中配置nacos服务端依赖：（注意不要忘记版本号）" class="headerlink" title="1.在父工程，也就是包含所有服务的大pom.xml中配置nacos服务端依赖：（注意不要忘记版本号）"></a>1.在父工程，也就是包含所有服务的大pom.xml中配置nacos服务端依赖：（注意不要忘记版本号）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--            nacos管理依赖--&gt;</span><br><span class="line">           &lt;dependency&gt;</span><br><span class="line">               &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;</span><br><span class="line">               &lt;version&gt;2.2.5.RELEASE&lt;/version&gt;</span><br><span class="line">               &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">               &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">           &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-在子工程配置nacos客户端依赖："><a href="#2-在子工程配置nacos客户端依赖：" class="headerlink" title="2.在子工程配置nacos客户端依赖："></a>2.在子工程配置nacos客户端依赖：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--        nacos客户端依赖包--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-在子工程配置文件中注释到原来的eureka地址信息，加入nacos地址信息：-nacos是spring下的，这里省略了spring"><a href="#3-在子工程配置文件中注释到原来的eureka地址信息，加入nacos地址信息：-nacos是spring下的，这里省略了spring" class="headerlink" title="3.在子工程配置文件中注释到原来的eureka地址信息，加入nacos地址信息：(nacos是spring下的，这里省略了spring:)"></a>3.在子工程配置文件中注释到原来的eureka地址信息，加入nacos地址信息：(nacos是spring下的，这里省略了spring:)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cloud:</span><br><span class="line">  nacos:</span><br><span class="line">    server-addr: localhost:8848 #nacos服务器地址</span><br></pre></td></tr></table></figure>

<h2 id="4-注意先开启nacos服务，示例结果："><a href="#4-注意先开启nacos服务，示例结果：" class="headerlink" title="4.注意先开启nacos服务，示例结果："></a>4.注意先开启nacos服务，示例结果：</h2><p><img src="/../../images/image-20220707120214095.png" alt="image-20220707120214095"></p>
<h1 id="Nacos分级存储模型"><a href="#Nacos分级存储模型" class="headerlink" title="Nacos分级存储模型"></a>Nacos分级存储模型</h1><p><img src="/../../images/image-20220707143835782.png" alt="image-20220707143835782"></p>
<h1 id="Nacos如恶化设置实例的集群属性"><a href="#Nacos如恶化设置实例的集群属性" class="headerlink" title="Nacos如恶化设置实例的集群属性"></a>Nacos如恶化设置实例的集群属性</h1><h2 id="1-yml配置文件添加属性：（名称随意，按自己的名称修改）"><a href="#1-yml配置文件添加属性：（名称随意，按自己的名称修改）" class="headerlink" title="1.yml配置文件添加属性：（名称随意，按自己的名称修改）"></a>1.yml配置文件添加属性：（名称随意，按自己的名称修改）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">discovery:</span><br><span class="line">  cluster-name: SH #集群名称</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<p><img src="/../../images/image-20220707144426154.png" alt="image-20220707144426154"></p>
<h2 id="2-然后启动运行就行了，结果如下："><a href="#2-然后启动运行就行了，结果如下：" class="headerlink" title="2.然后启动运行就行了，结果如下："></a>2.然后启动运行就行了，结果如下：</h2><p><img src="/../../images/image-20220707144618990.png" alt="image-20220707144618990"></p>
<h2 id="Nacos根据集群负载均衡-配置优先选择本地集群（同一集群名）"><a href="#Nacos根据集群负载均衡-配置优先选择本地集群（同一集群名）" class="headerlink" title="Nacos根据集群负载均衡(配置优先选择本地集群（同一集群名）)"></a>Nacos根据集群负载均衡(配置优先选择本地集群（同一集群名）)</h2><h2 id="1-yml文件配置："><a href="#1-yml文件配置：" class="headerlink" title="1.yml文件配置："></a>1.yml文件配置：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">userservice: #要做配置的服务名称</span><br><span class="line">  ribbon:</span><br><span class="line">    NFLoadBalancerRuleClassName: com.alibaba.cloud.nacos.ribbon.NacosRule</span><br></pre></td></tr></table></figure>

<h2 id="2-示例结果："><a href="#2-示例结果：" class="headerlink" title="2.示例结果："></a>2.示例结果：</h2><p>非本地：未被访问</p>
<p><img src="/../../images/image-20220707152304154.png" alt="image-20220707152304154"></p>
<p>本地：被访问了</p>
<p><img src="/../../images/image-20220707152342244.png" alt="image-20220707152342244"></p>
<h2 id="3-特点："><a href="#3-特点：" class="headerlink" title="3.特点："></a>3.特点：</h2><p>1.优先访问本地集群</p>
<p>2.当本地没有可访问的的时候才会进行跨域访问</p>
<p>3.当可访问的本地有多个的时候，在内部进行随机访问</p>
<h1 id="Nacos服务实例的权重设置"><a href="#Nacos服务实例的权重设置" class="headerlink" title="Nacos服务实例的权重设置"></a>Nacos服务实例的权重设置</h1><p>1.在Nacos控制台设置权重值，一般是在0-1之间，double雷星</p>
<p><img src="/../../images/image-20220707153200114.png" alt="image-20220707153200114"></p>
<p>点击“编辑”，进行权重设置</p>
<p>2.同集群类的多个实例，权重越高被访问的频率越高，权重为0不会被访问</p>
<p>3.可以根据这种特点进行平滑升级</p>
<h1 id="Nacos环境隔离"><a href="#Nacos环境隔离" class="headerlink" title="Nacos环境隔离"></a>Nacos环境隔离</h1><h2 id="1-新建一个命名空间"><a href="#1-新建一个命名空间" class="headerlink" title="1.新建一个命名空间"></a>1.新建一个命名空间</h2><p><img src="/../../images/image-20220707160530451.png" alt="image-20220707160530451"></p>
<p><img src="/../../images/image-20220707160547827.png" alt="image-20220707160547827"></p>
<p><img src="/../../images/image-20220707160608181.png" alt="image-20220707160608181"></p>
<h2 id="2-yml配置空间：namespace-命名空间id"><a href="#2-yml配置空间：namespace-命名空间id" class="headerlink" title="2.yml配置空间：namespace: 命名空间id"></a>2.yml配置空间：namespace: 命名空间id</h2><p><img src="/../../images/image-20220707160719686.png" alt="image-20220707160719686"></p>
<p><img src="/../../images/image-20220707160737700.png" alt="image-20220707160737700"></p>
<h2 id="3-总结：要想让服务可以访问，必须要放在相同的环境下"><a href="#3-总结：要想让服务可以访问，必须要放在相同的环境下" class="headerlink" title="3.总结：要想让服务可以访问，必须要放在相同的环境下"></a>3.总结：要想让服务可以访问，必须要放在相同的环境下</h2>
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-springcloud学习/Eureka&amp;Ribbon" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/07/04/springcloud%E5%AD%A6%E4%B9%A0/Eureka&Ribbon/" class="article-date">
      <time datetime="2022-07-04T09:38:08.577Z" itemprop="datePublished">2022-07-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>[TOC]</p>
<h1 id="Eureka注册中心"><a href="#Eureka注册中心" class="headerlink" title="Eureka注册中心"></a>Eureka注册中心</h1><h2 id="Eureka的作用"><a href="#Eureka的作用" class="headerlink" title="Eureka的作用"></a>Eureka的作用</h2><p><img src="/../../images/image-20220706112435950.png" alt="image-20220706112435950"></p>
<p><img src="/../../images/image-20220706112525041.png" alt="image-20220706112525041"></p>
<h2 id="搭建EurekaServer"><a href="#搭建EurekaServer" class="headerlink" title="搭建EurekaServer"></a>搭建EurekaServer</h2><h3 id="1-搭建注册中心"><a href="#1-搭建注册中心" class="headerlink" title="1.搭建注册中心"></a>1.搭建注册中心</h3><p>1.引入服务端依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--    导入eureka服务端依赖--&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>2.Application加上注解：@EnableEurekaServer&#x2F;&#x2F;eureka开关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@EnableEurekaServer//eureka开关</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class EurekaApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(EurekaApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.yml配置信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 10086 #服务端口</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: eurekaserver #服务名称</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    service-url: #eure ka的地址信息</span><br><span class="line">      defaultZone: http://127.0.0.1:10086/eureka</span><br></pre></td></tr></table></figure>

<h3 id="2-服务注册"><a href="#2-服务注册" class="headerlink" title="2.服务注册"></a>2.服务注册</h3><p>1.引入客户端依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--        导入eureke客户端依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>2.yml文件配置eureka地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: eurekaserver #服务名称</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    service-url: #eureka的地址信息</span><br><span class="line">      defaultZone: http://127.0.0.1:10086/eureka</span><br></pre></td></tr></table></figure>

<p>补充：如果想服务配置多个实例：</p>
<p><img src="/../../images/image-20220706172530194.png" alt="image-20220706172530194"></p>
<h3 id="3-服务发现"><a href="#3-服务发现" class="headerlink" title="3.服务发现"></a>3.服务发现</h3><p>1.给RestTemplate添加注解：@LoadBalanced</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Bean//创建RestTemplate并注入Spring容器</span><br><span class="line">@LoadBalanced</span><br><span class="line">public RestTemplate restTemplate()</span><br><span class="line">&#123;</span><br><span class="line">    return new RestTemplate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.用服务提供者的服务名称远程调用，例：</p>
<p><img src="/../../images/image-20220706173158139.png" alt="image-20220706173158139"></p>
<h1 id="Ribbon负载均衡"><a href="#Ribbon负载均衡" class="headerlink" title="Ribbon负载均衡"></a>Ribbon负载均衡</h1><h2 id="负载均衡流程："><a href="#负载均衡流程：" class="headerlink" title="负载均衡流程："></a>负载均衡流程：</h2><p><img src="/../../images/image-20220706174837139.png" alt="image-20220706174837139"></p>
<h2 id="修改负载均衡策略："><a href="#修改负载均衡策略：" class="headerlink" title="修改负载均衡策略："></a>修改负载均衡策略：</h2><p><img src="/../../images/image-20220706180851330.png" alt="image-20220706180851330"></p>
<h3 id="代码方式是针对全局的，配置文件方式是针对某个微服务而言的"><a href="#代码方式是针对全局的，配置文件方式是针对某个微服务而言的" class="headerlink" title="代码方式是针对全局的，配置文件方式是针对某个微服务而言的"></a>代码方式是针对全局的，配置文件方式是针对某个微服务而言的</h3><h2 id="Ribbon负载均衡策略"><a href="#Ribbon负载均衡策略" class="headerlink" title="Ribbon负载均衡策略"></a>Ribbon负载均衡策略</h2><p>Ribbon默认是采用懒加载，即第一次访问时才会去创建LoadBalanceClient,请求时间会很长。而饥饿加载则会再项目启动时创建，降低第一次访问的耗时，通过下面配置开启饥饿加载：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ribbon:</span><br><span class="line">  eager-load:</span><br><span class="line">    enabled: true #开启</span><br><span class="line">    clients: userservice #指定饥饿加载的服务名称</span><br></pre></td></tr></table></figure>

<p>注意clients部分，如果要加载多个服务，则：</p>
<p><img src="/../../images/image-20220706183350839.png" alt="image-20220706183350839"></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2022 tumiao
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >海贼到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>


<script src="/js/main.js"></script>


    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>